<!DOCTYPE html>
<html lang="en-US">
<head>
<!-- Universal Header Info Start -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/theme.css">
    <title> Synchronous Tropic Growth - SSEF </title>
    <link rel="icon" href="/images/d.ico" type="image/x-icon">

    <!-- Top navigation bar -->
    <div class="topnav">
        <a class="active" style="max-width: 70px;" href="/index.html"><i class="fa fa-fw fa-home"></i>Home</a>
        <a href="/about.html" style="max-width: 70px;">About</a>
        <a class="wide" style="border-color:white; border-width:2px; float: right; background-color: #04AA6D;width:20%;" href="/modeler.html"> Begin Modeling </a>
    </div>
<!-- Universal Header Info End -->


<!-- Page-specific Header Info Start -->
    <style>
        /* TITLE Flex Containers */
        .row {
            display: flex;
            background-color: #CBDFD1;
            padding: 10px;
            padding-top: 50px;
            padding-bottom: 50px;
        }

        .side {
            flex: 60%;
            display: flex;
            flex-direction: column;
            background-color: #CBDFD1;
            padding: 10px;
            padding-right: 30px;
            padding-top: 10px;
        }

        .side > h1, .side > h2 {
            text-align: right;
        }

        .main {
            flex: 40%;
            background-color: #CBDFD1;

        }

        /* SECTIONS Flex Containers */
        .sections {
            display: flex;
            flex-direction: row;
            border-top: 5px solid black;
        }
            .sections > h4 {
                text-align: center;
            }

            .pic {
                flex: 55%;
                flex-direction: row;
                margin: 0;

            }
            .text {
                padding: 53px;
                flex: 45%;
                flex-direction: row;
            }

        .title {
            border-top: 5px solid black;
            text-align: center;
            padding: 30px;
        }

        
        .title > h1 {
            font-size: 500%;
            font-weight: normal;

        }

        .title > h2 {
            font-size: 150%;
            font-weight: normal;
        }


        /* Responsive layout - when the screen is less than 700px wide, make the two columns stack on top of each other instead of next to each other */
        @media screen and (max-width: 375px) {
            .row {
                flex-direction: column-reverse;
            }
        }
    </style>
<!-- Page-specific Header Info End -->
</head>

<body>





            <div class="title" style="background-color: #CBDFD1;">
                <h1 style="text-align: center;"> <u><b>Modeler</b></u> </h1>
                <h2>A Novel Algorithm for Accurately Modeling Future Plant Growth from Photo- and Gravi-tropic Forces</h2>
            </div>

            <div class="sections" style="background-color: #90CAE1;">
                <div class="text">
                    <h4 style="text-align: center; font-size: 45px;"> Before you begin... </h4>
                    <p style="text-align: center;">
                        Algorithm does not fully consider all factors of growth and, as such, should be used as a guide, not a reality. 
                        Plant species, plant health (dehydration, overhydration, disease, etc.), intensity of stimuli, germination, etc. may all cause variance in accuracy.
                    </p>
                </div>
            </div>
            <div class="sections" style="background-color: #B1F1D1;">
                <div class="text">
                    <h4 style="font-size: 45px;"><b>1.</b> Measure vertical height </h4>
                    <h5> Measure the absolute vertical height of a line from the horizontal coordinate of the shoot tip to the light source.</h5>
                    <p style="padding-top: 5px; padding-bottom: 20px;">
                        See video for instructions. Input may be positive or negative.
                    </p>
                    
                    <div class="form" style="display: flex; flex-direction: column; gap: 20px; border-radius: 30px; border:2px black; background-color: #0d2f60;padding: 20px;">
                        <p style="color: white;">Input vertical height in millimeters:</p>
                        <input type="text" placeholder="Type " id="h">
                        <button onclick="window.location.href='https://www.calculatorsoup.com/calculators/conversions/distance.php';">Free height to millimeters converter</button>
                    </div>
                </div>
                <div class="pic">
                    <figure>
                        <video width="640" height="480" controls>
                            <source src="/images/Step1Vid.mp4" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    </figure>
                </div>
            </div>
            <div class="sections" style="background-color: #B1F1D1;">
                <div class="text">
                    <h4 style="font-size: 45px;"> <b>2.</b> Measure horizontal distance </h4>
                    <h5> Measure the absolute horizontal distance of a line from the shoot tip to the vertical coordinate of the light source.</h5>
                    <p style="padding-top: 5px; padding-bottom: 20px;">
                        See video for instructions. Input should <i>only be positive.</i>
                    </p>
                    <div class="form" style="display: flex; flex-direction: column; gap: 20px; border-radius: 30px; border:2px black; background-color: #0d2f60;padding: 20px;">
                        <p style="color: white;">Input horizontal distance in millimeters:</p>
                        <input type="text" placeholder="Type " id="d">
                        <button onclick="window.location.href='https://www.calculatorsoup.com/calculators/conversions/distance.php';">Free distance to millimeters converter</button>
                    </div>
 
                </div>
                <div class="pic">
                    <figure>
                        <video width="640" height="480" controls>
                            <source src="/images/Step2Vid.mp4" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    </figure>
                </div>
            </div>
            <div class="sections" style="background-color: #0d2f60;">
                <div class="text">
                    <h4 style="color:white; text-align: center; font-size: 45px;"> <b>3.</b> See results </h4>
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 20px; border-radius: 30px; padding: 20px;">
                        <button style="background-color: #B1F1D1; width: 50%;" type="button" onclick="calculateResults();"> 3.1 Graph results </button>
                    </div>

                </div>
            </div>
            <div id="growth_model">
                <div class="overlay-marker">
                    <img src="/images/light.png" height="50">
                </div>
            </div> 





            <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    
            <!-- COMPUTATIONS -->
            <script>
                google.charts.load('current', {'packages':['corechart']});


                // Define variables
                const photoForce = 1.857852375;
                const graviForce = 1;
                const forceDenominator = photoForce + graviForce;
                const T = graviForce / forceDenominator;
                const maxGrowthIterations = 10000;
                const chartHeaders = ['distance', 'height'];
                const chartOptions = {
                    curveType: 'function',
                };
                var wentNegative = false;
                var negOrPos = false;

    
                // Computations
                function calculateResults () {
                    var documentDistance = document.getElementById("d").value;
                    var scaleFactor = window.innerWidth / documentDistance;
                    document.getElementById("growth_model").style.height = `${document.getElementById("h").value * scaleFactor}px`;
                    document.getElementById("growth_model").style.width = `${document.getElementById("d").value * scaleFactor}px`;

                    var results = [chartHeaders];
    
                    var originalLightPosition = {
                        height: document.getElementById('h').value,
                        distance: document.getElementById('d').value
                    }

                    var currentLightPosition = originalLightPosition;
                    results = [
                        ...results,
                        getResultArray(originalLightPosition, currentLightPosition)
                    ];
    
                    for(var i = 0; i < maxGrowthIterations; ++i) {
                        currentLightPosition = getLightPositionAfterGrowthIteration(currentLightPosition);
    
                        if (wentNegative == true && negOrPos == false) {
                            break;
                        }
    
                        results = [
                            ...results,
                            getResultArray(originalLightPosition, currentLightPosition)
                        ];

                    }
    
                    google.charts.setOnLoadCallback(function () {
                        var data = google.visualization.arrayToDataTable(results);                    
                        var chart = new google.visualization.LineChart(document.getElementById('growth_model'));                    
                        chart.draw(data, chartOptions);
                    });
                    function placeMarker(dataTable) {
                        var cli = this.getChartLayoutInterface();
                        var chartArea = cli.getChartAreaBoundingBox();
                        document.querySelector('.overlay-marker').style.top = document.getElementById("h").value + "px";
                        document.querySelector('.overlay-marker').style.left = document.getElementById("d").value + "px";
                    };
                }
    
                function getLightPositionAfterGrowthIteration(lightPosition) {
                    var h = lightPosition.height;
                    var d = lightPosition.distance;
                    
                    if (lightPosition.distance < 0) {
                        wentNegative = true;
                    }
    
                    if (lightPosition.distance > 0) {
                        negOrPos = false
                    } else if (lightPosition.distance < 0) {
                        negOrPos = true
                    }
    
                    if (d > 0) {
                        var L = Math.atan(h / d);
                        var M = (Math.PI / 2) - L;
                        var b = M * T;
                        var G = b + L;
                        var e = Math.sin(G);
                        var k = Math.cos(G);
    
                        return {
                            height: h - e,
                            distance: d - k
                        };
                    } else if (d < 0 && h < 0) {
                        var L = Math.atan(d / h);
                        var M = Math.PI + L;
                        var b = M * T;
                        var G = b - L;
                        var e =  -1 * (Math.cos(G));
                        var k = Math.sin(G);
    
                        return {
                            height: h - e,
                            distance: d - k
                        };
                    } else if (d < 0 && h > 0) {
                        var L = Math.abs(Math.atan(h / d))
                        var M = (Math.PI * 1.5) + L;
                        var b = M * T;
    
                        if (M - b > Math.PI) {
                            var G = b - L;
                            var e = -1 * (Math.sin(G));
                            var k = -1 * (Math.cos(G));
    
                            return {
                            height: h - e,
                            distance: d - k
                            };
                        } else if (M - b < Math.PI) {
                            var G = (M - b) - (Math.PI / 2);
                            var e = -1 * (Math.sin(G));
                            var k = Math.cos(G);
    
                            return {
                                height: h - e,
                                distance: d - k
                            };
                        }
                    }
    
    
                }
    
                function getResultArray(originalLightPosition, lightPosition) {
                    return [
                        originalLightPosition.distance - lightPosition.distance,
                        originalLightPosition.height - lightPosition.height
                    ];
                }
            </script>
        </body>
    </html>